{% extends 'base.html' %}

{% block title %}Gráficas de Ventas{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Gráficas de Muebles Más Vendidos</h1>
    
    <form method="get" action="{{ url_for('graficas') }}">
        <div class="row mb-4">
            <div class="col-md-6">
                <label for="mes">Mes:</label>
                <select class="form-control" id="mes" name="mes">
                    {% for i in range(1, 13) %}
                        <option value="{{ i }}" {% if i == mes %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <label for="anio">Año:</label>
                <select class="form-control" id="anio" name="anio">
                    {% for i in range(2020, 2026) %}
                        <option value="{{ i }}" {% if i == anio %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Actualizar Reportes</button>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Volver al Panel</a>
    </form>

    {% if muebles_top %}
        <div id="mueblesChart" style="width: 100%; height: 500px;"></div>
    {% else %}
        <p class="alert alert-warning">No hay datos disponibles para mostrar.</p>
    {% endif %}
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Mueble', 'Cantidad Vendida'],
            {% for mueble in muebles_top %}
                ['{{ mueble[1] }}', {{ mueble[2] }}]{% if not loop.last %},{% endif %}
            {% endfor %}
        ]);

        var options = {
            title: 'Muebles Más Vendidos',
            hAxis: {title: 'Muebles', titleTextStyle: {color: '#333'}},
            vAxis: {title: 'Cantidad Vendida', minValue: 0},
            chartArea: {width: '70%', height: '70%'}
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('mueblesChart'));
        chart.draw(data, options);
    }
</script>
{% endblock %}
